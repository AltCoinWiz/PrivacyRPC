<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Jupiter Swap - Solana DEX</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0f;
      color: #fff;
      min-height: 100vh;
      padding: 40px;
    }
    .container { max-width: 500px; margin: 0 auto; }
    .logo {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 40px;
      color: #5AF5F5;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo img { width: 40px; height: 40px; }
    .card {
      background: #050505;
      border: 1px solid #1E2328;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
    }
    h2 { margin-bottom: 20px; color: #fff; }
    .btn {
      width: 100%;
      padding: 14px;
      background: #5AF5F5;
      border: none;
      border-radius: 8px;
      color: #000;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .btn:hover { opacity: 0.9; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .status {
      margin-top: 20px;
      padding: 16px;
      background: #000;
      border: 1px solid #ff4757;
      border-radius: 8px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
      max-height: 300px;
      overflow-y: auto;
      color: #ff4757;
    }
    .test-info {
      background: rgba(255,184,0,0.05);
      border: 1px solid #FFB800;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      font-size: 12px;
    }
    .test-info h4 { color: #FFB800; margin-bottom: 8px; font-size: 13px; }
    .test-info p { color: #7D7D7D; line-height: 1.5; }
    .wallet-info {
      background: rgba(90, 245, 245, 0.05);
      border: 1px solid #5AF5F5;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 11px;
      word-break: break-all;
      color: #5AF5F5;
    }
    p { color: #7D7D7D; }
  </style>
  <!-- Buffer polyfill required for Solana web3.js -->
  <script src="https://bundle.run/buffer@6.0.3"></script>
  <script>window.Buffer = window.Buffer || buffer.Buffer;</script>
  <!-- Solana Web3.js from CDN -->
  <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="logo">Jupiter</div>

    <div class="test-info">
      <h4>TEST: Rapid Asset Enumeration (REAL WALLET)</h4>
      <p>This connects to YOUR Phantom wallet and fires 10+ RPC calls within 2 seconds to simulate drainer behavior. PrivacyRPC should detect rapid enumeration pattern and show warnings.</p>
    </div>

    <div class="card">
      <h2>Connect Wallet to Swap</h2>
      <p style="color: #888; margin-bottom: 20px;">Connect your wallet to access the best rates on Solana</p>

      <div class="wallet-info" id="walletInfo" style="display: none;">
        Connected: <span id="walletAddress">-</span>
      </div>

      <button class="btn" id="connectBtn" onclick="connectAndEnumerate()">Connect Wallet</button>
    </div>

    <div class="status" id="status" style="display: none;"></div>
  </div>

  <script>
    // Use Solana Devnet for safety (won't affect real funds)
    const RPC_URL = 'https://api.devnet.solana.com';
    const connection = new solanaWeb3.Connection(RPC_URL, 'confirmed');

    let wallet = null;

    function log(msg) {
      const status = document.getElementById('status');
      status.style.display = 'block';
      status.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
      status.scrollTop = status.scrollHeight;
      console.log('[DrainerTest]', msg);
    }

    async function connectAndEnumerate() {
      const btn = document.getElementById('connectBtn');

      // Check for Phantom
      if (!window.solana || !window.solana.isPhantom) {
        log('ERROR: Phantom wallet not found!');
        alert('Please install Phantom wallet extension');
        return;
      }

      try {
        btn.disabled = true;
        btn.textContent = 'Connecting...';

        // Connect to Phantom
        log('Requesting Phantom connection...');
        const resp = await window.solana.connect();
        wallet = resp.publicKey;

        const addr = wallet.toString();
        document.getElementById('walletInfo').style.display = 'block';
        document.getElementById('walletAddress').textContent = addr;
        btn.textContent = 'Running Enumeration...';

        log('');
        log('=== WALLET CONNECTED ===');
        log('Address: ' + addr);
        log('');
        log('Starting DRAINER PATTERN simulation...');
        log('PrivacyRPC should detect rapid enumeration!');
        log('');

        const startTime = Date.now();

        // DRAINER PATTERN: Rapid enumeration of all assets
        // This is what real drainers do to find everything to steal

        // 1. Get SOL balance
        log('-> getBalance');
        await connection.getBalance(wallet);

        // 2. Get all token accounts (SPL tokens)
        log('-> getTokenAccountsByOwner (SPL tokens)');
        await connection.getTokenAccountsByOwner(wallet, {
          programId: new solanaWeb3.PublicKey('TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA')
        });

        // 3. Get all token-2022 accounts
        log('-> getTokenAccountsByOwner (Token-2022)');
        await connection.getTokenAccountsByOwner(wallet, {
          programId: new solanaWeb3.PublicKey('TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb')
        });

        // 4-8. Multiple getAccountInfo calls (checking specific high-value tokens)
        const tokenMints = [
          'So11111111111111111111111111111111111111112', // wSOL
          'EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v', // USDC
          'Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB', // USDT
          'DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263', // BONK
          'JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN'   // JUP
        ];

        for (const mint of tokenMints) {
          log(`-> getAccountInfo (${mint.substring(0, 8)}...)`);
          try {
            await connection.getAccountInfo(new solanaWeb3.PublicKey(mint));
          } catch (e) {
            // Some accounts might not exist, that's ok
          }
        }

        // 9. Get recent blockhash (preparing transaction)
        log('-> getLatestBlockhash');
        await connection.getLatestBlockhash();

        // 10-12. More account checks
        log('-> getAccountInfo (user account)');
        await connection.getAccountInfo(wallet);

        log('-> getBalance (recheck)');
        await connection.getBalance(wallet);

        const elapsed = Date.now() - startTime;

        log('');
        log('=== ENUMERATION COMPLETE ===');
        log(`Total calls: 12 in ${elapsed}ms`);
        log('Pattern matches: DRAINER ASSET SCAN');
        log('');
        log('PrivacyRPC should have detected:');
        log('- Rapid enumeration pattern (5+ calls in 5 sec)');
        log('- Multiple getTokenAccountsByOwner');
        log('- Sequential getAccountInfo calls');
        log('');
        log('CHECK: Did you see a warning notification?');

        btn.textContent = 'Test Complete - Run Again';
        btn.disabled = false;

      } catch (e) {
        log('ERROR: ' + e.message);
        btn.textContent = 'Connect Wallet';
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
